<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback - Info PSI</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        :root {
            --primary: #d32f2f;
            --dark: #212529;
            --light: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--light);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            background: #fff;
        }
        .navbar-brand { font-weight: 700; color: var(--primary) !important; }

        .feedback-card {
            max-width: 600px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border-top: 5px solid var(--primary);
        }

        .star-rating {
            display: flex;
            justify-content: center;
            gap: 10px;
            font-size: 2rem;
            color: #ddd;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .star-rating i.active {
            color: #ffc107;
        }

        .btn-send {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            padding: 12px;
            border-radius: 50px;
            width: 100%;
            border: none;
            transition: 0.3s;
        }
        .btn-send:hover {
            background-color: #b71c1c;
            color: white;
        }

        /* Success Animation */
        .success-message {
            display: none;
            text-align: center;
            padding: 20px;
        }
        .success-icon {
            font-size: 50px;
            color: #28a745;
            margin-bottom: 15px;
        }

        footer {
            background: var(--dark);
            color: white;
            padding: 30px 0;
            margin-top: auto;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fa-solid fa-fire-extinguisher"></i> Info PSI
            </a>
            <a href="index.html" class="btn btn-outline-dark btn-sm rounded-pill">
                <i class="fa-solid fa-arrow-left"></i> √énapoi
            </a>
        </div>
    </nav>

    <div class="container">
        <div class="feedback-card" id="formCard">
            <h2 class="text-center fw-bold mb-3">PƒÉrerea ta conteazƒÉ!</h2>
            <p class="text-center text-muted mb-4">Ai √Ænt√¢mpinat probleme sau ai sugestii pentru aplica»õia Registru PSI? Scrie-ne »ôi mesajul va ajunge instant la noi pe WhatsApp.</p>

            <form id="feedbackForm" onsubmit="submitFeedback(event)">
                
                <div class="text-center mb-2">Nota ta:</div>
                <div class="star-rating" id="starRating">
                    <i class="fa-solid fa-star" data-val="1"></i>
                    <i class="fa-solid fa-star" data-val="2"></i>
                    <i class="fa-solid fa-star" data-val="3"></i>
                    <i class="fa-solid fa-star" data-val="4"></i>
                    <i class="fa-solid fa-star" data-val="5"></i>
                </div>
                <input type="hidden" id="ratingValue" value="5">

                <div class="mb-3">
                    <label class="form-label fw-bold">Numele tƒÉu</label>
                    <input type="text" id="nameIn" class="form-control" placeholder="Ex: Ion Popescu" required>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Telefon / Email (Op»õional)</label>
                    <input type="text" id="contactIn" class="form-control" placeholder="Pentru a te putea contacta">
                </div>

                <div class="mb-4">
                    <label class="form-label fw-bold">Mesaj / Sugestie</label>
                    <textarea id="msgIn" class="form-control" rows="4" placeholder="Ce putem √ÆmbunƒÉtƒÉ»õi?" required></textarea>
                </div>

                <button type="submit" class="btn btn-send" id="submitBtn">
                    <i class="fa-brands fa-whatsapp"></i> Trimite Feedback
                </button>
            </form>
        </div>

        <div class="feedback-card success-message" id="successCard">
            <div class="success-icon"><i class="fa-solid fa-circle-check"></i></div>
            <h3>Mul»õumim!</h3>
            <p class="text-muted">Mesajul tƒÉu a fost trimis cu succes cƒÉtre echipa tehnicƒÉ.</p>
            <a href="index.html" class="btn btn-outline-dark mt-3">√énapoi la AcasƒÉ</a>
        </div>
    </div>

    <footer>
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 Eviden»õƒÉ PSI.</p>
        </div>
    </footer>

    <script>
        // Star Rating Logic
        const stars = document.querySelectorAll('.star-rating i');
        const ratingInput = document.getElementById('ratingValue');

        // Init default
        highlightStars(5);

        stars.forEach(star => {
            star.addEventListener('click', () => {
                const val = star.getAttribute('data-val');
                ratingInput.value = val;
                highlightStars(val);
            });
        });

        function highlightStars(val) {
            stars.forEach(star => {
                if(star.getAttribute('data-val') <= val) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // Submit Logic
        async function submitFeedback(e) {
            e.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Se trimite...';

            const nume = document.getElementById('nameIn').value.trim();
            const contact = document.getElementById('contactIn').value.trim();
            const mesaj = document.getElementById('msgIn').value.trim();
            const rating = document.getElementById('ratingValue').value;

            // Construim mesajul pentru WhatsApp
            const finalMsg = `üåü FEEDBACK NOU\n\nüë§ Nume: ${nume}\nüìû Contact: ${contact || '-'}\n‚≠ê NotƒÉ: ${rating}/5\n\nüí¨ Mesaj:\n${mesaj}`;

            const API = '/api.php';
            const KEY = 'hfn@2025';

            try {
                // Trimitem catre API-ul PHP care are functia de WhatsApp
                const response = await fetch(API, {
                    method: 'POST',
                    body: JSON.stringify({
                        api: KEY,
                        action: 'send_feedback', // Actiune noua pe care o adaugam in PHP
                        mesaj: finalMsg
                    })
                });

                const result = await response.json();

                if(result.success) {
                    document.getElementById('formCard').style.display = 'none';
                    document.getElementById('successCard').style.display = 'block';
                } else {
                    alert('Eroare la trimitere: ' + (result.message || 'NecunoscutƒÉ'));
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            } catch (err) {
                alert('Eroare de comunicare cu serverul.');
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }
    </script>
</body>
</html>
